import{a as h,b as r}from"./entry.97438936.js";const d=h({__name:"auth",setup(l){c();function c(){const e=new URLSearchParams(window.location.search);if(e.has("error")){n("Spotify Authorization error: "+e.get("error"));return}if(localStorage.getItem("auth-state")!=e.get("state")){n("State missmatch. The authorization integrity might have been compormized!");return}const i=new URL(window.location.href);i.search="";const s={grant_type:"authorization_code",code:e.get("code"),redirect_uri:i.toString(),client_id:"20aa48c2719e42c0be5f3b834942f06d",code_verifier:localStorage.getItem("code-verifier")},o=fetch("https://accounts.spotify.com/api/token",{method:"POST",body:new URLSearchParams(s),headers:{"Content-Type":"application/x-www-form-urlencoded"}});o.then(a=>a.json().then(t=>{if(t.error){console.error(t.error),r("/error?redirect-uri=/login");return}localStorage.setItem("auth-token",t.access_token),localStorage.setItem("refresh-token",t.refresh_token),localStorage.setItem("auth-token-expiration-timestamp",(t.expires_in*1e3+Date.now()).toString()),r("/home")})),o.catch(a=>{console.error(a),r("/error?redirect-uri=/login")}),o.finally(()=>{localStorage.removeItem("code-verifier"),localStorage.removeItem("auth-state")})}function n(e){console.error(e),r("/error?redirect-uri=/login")}return()=>{}}});export{d as default};
